---
// 1. Importar utilidades y el componente de icono
import { useTranslations } from '../../i18n/utils';
import allCertifications from '../../data/certifications.js'; // Importar el OBJETO
import IconArrow from '../icons/IconArrow.astro';

// 2. Obtener idioma y funciÃ³n 't'
const { currentLocale } = Astro;
const lang = currentLocale as 'es' | 'en';
const t = useTranslations(lang);

// 3. Seleccionar el array de datos del idioma correcto
// SOLUCIÃ“N: Usamos '(as any)' para solucionar el error de TypeScript
const certifications = (allCertifications as any)[lang] || (allCertifications as any).es;

// 4. LÃ³gica de paginaciÃ³n
const CERTS_PER_PAGE = 5;
const totalPages = Math.ceil(certifications.length / CERTS_PER_PAGE);
const pages = Array.from({ length: totalPages }, (_, i) => 
  certifications.slice(i * CERTS_PER_PAGE, (i + 1) * CERTS_PER_PAGE)
);
---
<section id="certifications" class="section-spacing">
  <div class="max-w-5xl mx-auto px-8">
    
    <div class="flex justify-between items-center mb-6">
      <h2 class="section-title text-slate-900 dark:text-slate-100 mb-0">
        <span class="icon-emoji">ðŸ“œ</span>
        {t('certifications.title')} <!-- Corregido: Comentario fuera de la etiqueta -->
      </h2>
      
      <div class="certification-nav hidden sm:flex gap-2">
        <!-- Corregido: Comentarios eliminados de dentro de las etiquetas -->
        <button id="scroll-left" aria-label={t('certifications.scrollLeft')} class="nav-button">â€¹</button>
        <button id="scroll-right" aria-label={t('certifications.scrollRight')} class="nav-button">â€º</button>
      </div>
    </div>
    
    <div id="certifications-slider" class="certifications-container">
      {pages.map((pageCerts, pageIndex) => (
        <div class="certification-page" data-page={pageIndex}>
          <ul class="certification-list">
            {pageCerts.map(cert => {
              const isValidUrl = cert.link && (cert.link.startsWith('http://') || cert.link.startsWith('https://'));
              const Tag = isValidUrl ? 'a' : 'div';
              const tagProps = isValidUrl ? {
                href: cert.link,
                target: "_blank",
                rel: "noopener noreferrer"
              } : {};

              return (
                <li class="certification-item">
                  <Tag 
                    class:list={["certification-link", { 'no-link': !isValidUrl }]}
                    {...tagProps}
                  >
                    <div class="certification-content">
                      <h3 class="certification-title">{cert.title}</h3>
                      <p class="certification-meta">{cert.issuer} â€¢ {cert.year}</p>
                      {!isValidUrl && cert.link && cert.link !== '#' && (
                        <!-- Corregido: Comentario eliminado de dentro de la etiqueta -->
                        <p class="certification-id">{t('certifications.credentialID')}: {cert.link}</p>
                      )}
                    </div>
                    
                    {isValidUrl && <IconArrow />}
                  </Tag>
                </li>
              );
            })}
          </ul>
        </div>
      ))}
    </div>

    {totalPages > 1 && (
      <div class="flex justify-center gap-2 mt-4">
        {Array.from({ length: totalPages }).map((_, i) => (
          <button 
            class="page-indicator" 
            data-page-index={i}
            aria-label={`${t('certifications.goToPage')} ${i + 1}`}
          />
        ))}
      </div>
    )}
  </div>
</section>

<script>
  import { initCertificationsSlider } from '../../scripts/certifications-slider';
  
  // Inicializar el slider cuando el DOM estÃ© listo
  initCertificationsSlider();
</script>

<style>
  .certification-id {
    @apply text-xs font-mono mt-1;
    @apply text-slate-500 dark:text-slate-400;
  }
  .certification-link.no-link {
    cursor: default;
  }
  .certification-link.no-link:hover {
    @apply border-slate-200 dark:border-slate-700 shadow-none !important;
  }
  .certification-link.no-link :global(.certification-arrow) {
    display: none;
  }
  .certification-link.no-link:hover :global(.certification-arrow) {
    @apply opacity-0 translate-x-[-0.5rem] !important;
  }
</style>

